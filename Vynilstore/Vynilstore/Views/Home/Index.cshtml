@using ApiVynil.Models
@using System.Security.Claims

@{
    ViewData["Title"] = "Home";
    var featuredVinyls = ViewBag.FeaturedVinyls as List<Vinyl> ?? new List<Vinyl>();
    var artists = ViewBag.Artists as List<Artist> ?? new List<Artist>();

    // Функция для получения имени исполнителя по ID
    string GetArtistName(int artistId)
    {
        var artist = artists.FirstOrDefault(a => a.Id == artistId);
        if (artist != null)
        {
            return artist.Name;
        }
        return $"Исполнитель #{artistId}";
    }

    // Функция для корректировки пути к изображению
    string FixImagePath(string path)
    {
        if (string.IsNullOrEmpty(path))
            return "/images/no-image.jpg";
        
        if (path.StartsWith("http"))
            return path;

        // Удаляем тильду в начале пути, если она есть
        if (path.StartsWith("~"))
            path = path.Substring(1);
            
        // Проверяем начинается ли путь со слэша
        if (!path.StartsWith("/"))
            path = "/" + path;
            
        return path;
    }
}

<!-- Hero Section -->
<section class="hero text-center">
    <div class="container">
        <h1 class="display-2 mb-4">АНАЛОГОВОЕ КАЧЕСТВО</h1>
        <p class="lead mb-5">Погрузитесь в мир винилового звучания с нашей коллекцией</p>
        <div class="row justify-content-center">
            <div class="col-md-4">
                <a href="#featured" class="btn btn-primary btn-lg w-100 mb-3">СМОТРЕТЬ КОЛЛЕКЦИЮ</a>
            </div>
            <div class="col-md-4">
                <a asp-controller="Home" asp-action="Catalog" class="btn btn-outline-light btn-lg w-100">КАТАЛОГ</a>
            </div>
        </div>
    </div>
</section>

@if (User.Identity?.IsAuthenticated == true)
{
    <div class="container mt-5">
        <div class="card bg-dark text-light border-0">
            <div class="card-body">
                <h4>Здравствуйте, @User.FindFirst(ClaimTypes.GivenName)?.Value. @User.FindFirst(ClaimTypes.Role)?.Value</h4>
                <p class="mb-0">Добро пожаловать на наш сайт. Приятного прослушивания!</p>
            </div>
        </div>
    </div>
}

<!-- About Section -->
<section class="container mt-5 mb-5">
    <div class="row align-items-center">
        <div class="col-md-6">
            <img src="/media/vinyl-player.png" alt="Vinyl Player" class="img-fluid rounded shadow">
        </div>
        <div class="col-md-6">
            <h2 class="section-title text-uppercase mb-4">О нас</h2>
            <p class="mb-4">VYNILSTORE — это место для истинных ценителей музыки. Мы предлагаем тщательно отобранную коллекцию виниловых пластинок всех жанров и эпох.</p>
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="d-flex align-items-center mb-3">
                        <i class="fas fa-record-vinyl text-primary me-3" style="font-size: 24px;"></i>
                        <div>
                            <h5 class="mb-0">Редкие издания</h5>
                            <p class="mb-0 text-muted">Коллекционные релизы</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="d-flex align-items-center mb-3">
                        <i class="fas fa-music text-primary me-3" style="font-size: 24px;"></i>
                        <div>
                            <h5 class="mb-0">Все жанры</h5>
                            <p class="mb-0 text-muted">От джаза до метала</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <div class="d-flex align-items-center mb-3">
                        <i class="fas fa-headphones text-primary me-3" style="font-size: 24px;"></i>
                        <div>
                            <h5 class="mb-0">Прослушивание</h5>
                            <p class="mb-0 text-muted">Тестовые стенды</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-truck text-primary me-3" style="font-size: 24px;"></i>
                        <div>
                            <h5 class="mb-0">Доставка</h5>
                            <p class="mb-0 text-muted">По всей России</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Featured Vinyls Section -->
<section id="featured" class="bg-dark py-5">
    <div class="container">
        <h2 class="section-title text-uppercase text-light text-center mb-5">Рекомендуемые альбомы</h2>
        <div class="row">
            @if (featuredVinyls != null && featuredVinyls.Any())
            {
                @foreach (var vinyl in featuredVinyls.Take(4))
                {
                    <div class="col-md-3 mb-4">
                        <div class="card product-card h-100 border-0">
                            <div class="position-relative">
                                <img src="@FixImagePath(vinyl.CoverImagePath)" class="card-img-top album-cover" alt="@vinyl.Title" style="height: 300px; object-fit: cover;">
                                <div class="position-absolute bottom-0 start-0 w-100 p-3 bg-dark bg-opacity-75">
                                    <h6 class="card-title text-light mb-0">@vinyl.Title</h6>
                                    <p class="card-text text-light mb-0">@GetArtistName(vinyl.ArtistId)</p>
                                </div>
                            </div>
                            <div class="card-body d-flex flex-column justify-content-between">
                                <div>
                                    <p class="text-primary fw-bold mb-3">@vinyl.Price.ToString("C0")</p>
                                </div>
                                <div class="d-flex">
                                    <a asp-controller="Home" asp-action="VinylDetails" asp-route-id="@vinyl.Id" class="btn btn-outline-primary btn-sm flex-grow-1 me-2">Подробнее</a>
                                    <button class="btn btn-primary btn-sm add-to-cart-btn flex-grow-1"
                                            data-vinyl-id="@vinyl.Id" 
                                            data-vinyl-title="@vinyl.Title">
                                        <i class="fas fa-shopping-cart"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="col-12 text-center">
                    <p class="text-light">В данный момент нет рекомендуемых пластинок.</p>
                </div>
            }
        </div>
        <div class="text-center mt-4">
            <a asp-controller="Home" asp-action="Catalog" class="btn btn-outline-light px-4 py-2">Смотреть больше</a>
        </div>
    </div>
</section>

<!-- Newsletter Section -->
<section class="bg-dark py-5 text-light mb-4">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-8 text-center">
                <h2 class="mb-4">Подпишитесь на рассылку</h2>
                <p class="mb-4">Получайте информацию о новых поступлениях, распродажах и музыкальных событиях</p>
                <div class="row justify-content-center">
                    <div class="col-md-8">
                        <div class="input-group mb-3">
                            <input type="email" class="form-control" placeholder="Ваш email" aria-label="Ваш email">
                            <button class="btn btn-primary" type="button">Подписаться</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
</div>
</section>

@section Scripts {
    <script>
        // Функционал для кнопок "Добавить в корзину"
        document.addEventListener('DOMContentLoaded', function() {
            // Функционал из site.js уже реализован
        });
    </script>
}
